<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Data Analysis and Visualization in Python for Ecologists: Making Plots With plotnine</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/dc/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/dc/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/dc/favicon-16x16.png"><link rel="manifest" href="../favicons/dc/site.webmanifest"><link rel="mask-icon" href="../favicons/dc/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav data"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dc-logo" alt="Data Carpentry" src="../assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../07-visualization-ggplot-python.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="../assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Data Analysis and Visualization in Python for Ecologists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Data Analysis and Visualization in Python for Ecologists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="CONTRIBUTORS.html">About Contributors</a></li><li><a class="dropdown-item" href="extra_challenges.html">Extra Challenges</a></li><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="jupyter_notebooks.html">Overview of Jupyter Notebooks</a></li><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Data Analysis and Visualization in Python for Ecologists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 60%" class="percentage">
    60%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 60%" aria-valuenow="60" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../07-visualization-ggplot-python.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-before-we-start.html">1. Before we start</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-short-introduction-to-Python.html">2. Short Introduction to Programming in Python</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-starting-with-data.html">3. Starting With Data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-index-slice-subset.html">4. Indexing, Slicing and Subsetting DataFrames in Python</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="04-data-types-and-format.html">5. Data Types and Formats</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="05-merging-data.html">6. Combining DataFrames with Pandas</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="06-loops-and-functions.html">7. Data Workflows and Automation</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        8. Making Plots With plotnine
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#disclaimer">Disclaimer</a></li>
<li><a href="#plotting-with-plotnine">Plotting with plotnine</a></li>
<li><a href="#building-your-plots-iteratively">Building your plots iteratively</a></li>
<li><a href="#plotting-distributions">Plotting distributions</a></li>
<li><a href="#plotting-time-series-data">Plotting time series data</a></li>
<li><a href="#faceting">Faceting</a></li>
<li><a href="#further-customization">Further customization</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="08-putting-it-all-together.html">9. Data Ingest and Visualization - Matplotlib and Pandas</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="09-working-with-sql.html">10. Accessing SQLite Databases Using Python and Pandas</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <li><a href="CONTRIBUTORS.html">About Contributors</a></li><li><a href="extra_challenges.html">Extra Challenges</a></li><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="jupyter_notebooks.html">Overview of Jupyter Notebooks</a></li><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/06-loops-and-functions.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/08-putting-it-all-together.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/06-loops-and-functions.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Data Workflows and
        </a>
        <a class="chapter-link float-end" href="../instructor/08-putting-it-all-together.html" rel="next">
          Next: Data Ingest and...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Making Plots With plotnine</h1>
        <p>Last updated on 2024-03-29 |

        <a href="https://github.com/datacarpentry/python-ecology-lesson/edit/main/episodes/07-visualization-ggplot-python.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 90 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I visualize data in Python?</li>
<li>What is ‘grammar of graphics’?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Create a <code>plotnine</code> object.</li>
<li>Set universal plot settings.</li>
<li>Modify an existing plotnine object.</li>
<li>Change the aesthetics of a plot such as color.</li>
<li>Edit the axis labels.</li>
<li>Build complex plots using a step-by-step approach.</li>
<li>Create scatter plots, box plots, and time series plots.</li>
<li>Use the facet_wrap and facet_grid commands to create a collection of
plots splitting the data by a factor variable.</li>
<li>Create customized plot styles to meet their needs.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a></h2>
<hr class="half-width"><p>Python has powerful built-in plotting capabilities such as
<code>matplotlib</code>, but for this episode, we will be using the <a href="https://github.com/has2k1/plotnine?tab=readme-ov-file" class="external-link">plotnine</a>
package, which facilitates the creation of highly-informative plots of
structured data based on the R implementation of <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> and <a href="https://link.springer.com/book/10.1007%2F0-387-28695-0" class="external-link">The
Grammar of Graphics</a> by Leland Wilkinson. The <code>plotnine</code>
package is built on top of Matplotlib and interacts well with
Pandas.</p>
<div id="reminder" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="reminder" class="callout-inner">
<h3 class="callout-title">Reminder</h3>
<div class="callout-content">
<p><code>plotnine</code> is not included in the standard Anaconda
installation and needs to be installed separately. If you haven’t done
so already, you can find installation instructions on the <a href="https://datacarpentry.org/python-ecology-lesson/#required-python-packages" class="external-link">Setup
page</a>.</p>
</div>
</div>
</div>
<p>Just as with the other packages, <code>plotnine</code> needs to be
imported. It is good practice to not just load an entire package such as
<code>from plotnine import *</code>, but to use an abbreviation as we
used <code>pd</code> for Pandas:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> plotnine <span class="im">as</span> p9</span></code></pre>
</div>
<p>From now on, the functions of <code>plotnine</code> are available
using <code>p9.</code>. For the exercise, we will use the
<code>surveys.csv</code> data set, with the <code>NA</code> values
removed</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>surveys_complete <span class="op">=</span> pd.read_csv(<span class="st">'data/surveys.csv'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>surveys_complete <span class="op">=</span> surveys_complete.dropna()</span></code></pre>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>If learners have trouble generating the output, or anything happens
with that, the folder <a href="https://github.com/datacarpentry/python-ecology-lesson/tree/main/sample_output" class="external-link"><code>sample_output</code></a>
in this repository contains the file <code>surveys_complete.csv</code>
with the data they should generate.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="plotting-with-plotnine">Plotting with plotnine<a class="anchor" aria-label="anchor" href="#plotting-with-plotnine"></a></h2>
<hr class="half-width"><p>The <code>plotnine</code> package (cfr. other packages conform The
Grammar of Graphics) supports the creation of complex plots from data in
a dataframe. It uses default settings, which help creating publication
quality plots with a minimal amount of settings and tweaking.</p>
<p><code>plotnine</code> graphics are built step by step by adding new
elements adding different elements on top of each other using the
<code>+</code> operator. Putting the individual steps together in
brackets <code>()</code> provides Python-compatible syntax.</p>
<p>To build a <code>plotnine</code> graphic we need to:</p>
<ul><li>Bind the plot to a specific data frame using the <code>data</code>
argument:</li>
</ul><div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete))</span></code></pre>
</div>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>Note <code>plotnine</code> contains a <em>lot</em> of deprecation
warnings in some versions of python/matplotlib, warnings may need to be
suppressed with</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>warnings.filterwarnings(action<span class="op">=</span><span class="st">'once'</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>As we have not defined anything else, just an empty figure is
available and presented.</p>
<ul><li>Define aesthetics (<code>aes</code>), by <strong>selecting
variables</strong> used in the plot and <code>mapping</code> them to a
presentation such as plotting size, shape, color, etc. You can interpret
this as: <strong>which</strong> of the variables will influence the
plotted objects/geometries:</li>
</ul><div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>)))</span></code></pre>
</div>
<p>The most important aes mappings are: <code>x</code>, <code>y</code>,
<code>alpha</code>, <code>color</code>, <code>colour</code>,
<code>fill</code>, <code>linetype</code>, <code>shape</code>,
<code>size</code> and <code>stroke</code>.</p>
<ul><li>Still no specific data is plotted, as we have to define what kind of
geometry will be used for the plot. The most straightforward is probably
using points. Points is one of the <code>geoms</code> options, the
graphical representation of the data in the plot. Others are lines,
bars,… To add a geom to the plot use <code>+</code> operator:</li>
</ul><div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>))</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point()</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>The <code>+</code> in the <code>plotnine</code> package is
particularly useful because it allows you to modify existing
<code>plotnine</code> objects. This means you can easily set up plot
<em>templates</em> and conveniently explore different types of plots, so
the above plot can also be generated with code like this:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Create</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>surveys_plot <span class="op">=</span> p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                         mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>))</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co"># Draw the plot</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>surveys_plot <span class="op">+</span> p9.geom_point()</span></code></pre>
</div>
<figure><img src="../fig/06_first_plot.png" alt="scatter plot of hindfoot length vs weight with black dots denoting individual sampled animals, showing 4 main clusters of dots in the middle and left middle sides" class="figure mx-auto d-block"></figure><div id="challenge---bar-chart" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---bar-chart" class="callout-inner">
<h3 class="callout-title">Challenge - bar chart</h3>
<div class="callout-content">
<p>Working on the <code>surveys_complete</code> data set, use the
<code>plot-id</code> column to create a <code>bar</code>-plot that
counts the number of records for each plot. (Check the documentation of
the bar geometry to handle the counts)</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Answers </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'plot_id'</span>))</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_bar()</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_challenge_bar.png" alt="bar chart of count of rodents caught at each plot site" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
<p>Notes:</p>
<ul><li>Anything you put in the <code>ggplot()</code> function can be seen
by any geom layers that you add (i.e., these are universal plot
settings). This includes the <code>x</code> and <code>y</code> axis you
set up in <code>aes()</code>.</li>
<li>You can also specify aesthetics for a given <code>geom</code>
independently of the aesthetics defined globally in the
<code>ggplot()</code> function.</li>
</ul></section><section><h2 class="section-heading" id="building-your-plots-iteratively">Building your plots iteratively<a class="anchor" aria-label="anchor" href="#building-your-plots-iteratively"></a></h2>
<hr class="half-width"><p>Building plots with <code>plotnine</code> is typically an iterative
process. We start by defining the dataset we’ll use, lay the axes, and
choose a geom. Hence, the <code>data</code>, <code>aes</code> and
<code>geom-*</code> are the elementary elements of any graph:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>))</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point()</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Then, we start modifying this plot to extract more information from
it. For instance, we can add transparency (alpha) to avoid
overplotting:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>))</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_alpha_plot.png" alt="scatter plot of hindfoot-length vs weight of rodents,  showing a curve increasing to a plateau" class="figure mx-auto d-block"></figure><p>We can also add colors for all the points</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_blue_plot.png" alt="scatter plot of hindfoot-length vs weight  of rodents, demonstrating overplotting" class="figure mx-auto d-block"></figure><p>Or to color each species in the plot differently, map the
<code>species_id</code> column to the color aesthetic:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'hindfoot_length'</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>                          color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_color_plot.png" alt="scatter plot of Hindfoot length vs weight with colors coordinating to specific species, showing abundance in the mid to lower left side of the plot" class="figure mx-auto d-block"></figure><p>Apart from the adaptations of the arguments and settings of the
<code>data</code>, <code>aes</code> and <code>geom-*</code> elements,
additional elements can be added as well, using the <code>+</code>
operator:</p>
<ul><li>Changing the labels:</li>
</ul><div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>, color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="op">+</span> p9.xlab(<span class="st">"Weight (g)"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_color_label_plot.png" alt="scatter plot of Hindfoot length vs weight (g) with colors coordinating to specific species, showing abundance in the mid to lower left side of the plot" class="figure mx-auto d-block"></figure><ul><li>Defining scale for colors, axes,… For example, a log-version of the
x-axis could support the interpretation of the lower numbers:</li>
</ul><div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>, color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    <span class="op">+</span> p9.xlab(<span class="st">"Weight (g)"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    <span class="op">+</span> p9.scale_x_log10()</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_log_plot.png" alt="Scatterplot of hindfoot length versus weight where logarithmic x-axis is used to distribute lower numbers" class="figure mx-auto d-block"></figure><ul><li>Changing the theme (<code>theme_*</code>) or some specific theming
(<code>theme</code>) elements. Usually plots with white background look
more readable when printed. We can set the background to white using the
function <code>theme_bw()</code>.</li>
</ul><div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>, color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    <span class="op">+</span> p9.xlab(<span class="st">"Weight (g)"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>    <span class="op">+</span> p9.scale_x_log10()</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>    <span class="op">+</span> p9.theme_bw()</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    <span class="op">+</span> p9.theme(text<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">16</span>))</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_white_plot.png" alt="Scatterplot of hindfoot length versus weight on a logarithmic x-axis using a white background" class="figure mx-auto d-block"></figure><div id="challenge---bar-plot-adaptations" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---bar-plot-adaptations" class="callout-inner">
<h3 class="callout-title">Challenge - Bar plot adaptations</h3>
<div class="callout-content">
<p>Adapt the bar plot of the previous exercise by mapping the
<code>sex</code> variable to the color fill of the bar chart. Change the
<code>scale</code> of the color fill by providing the colors
<code>blue</code> and <code>orange</code> manually (see <a href="https://plotnine.org/reference/" class="external-link">API reference</a> to find the
appropriate function).</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Answers </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'plot_id'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>                          fill<span class="op">=</span><span class="st">'sex'</span>))</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    <span class="op">+</span> p9.geom_bar()</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>    <span class="op">+</span> p9.scale_fill_manual([<span class="st">"blue"</span>, <span class="st">"orange"</span>])</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_challenge_color_bar.png" alt="Bar chart of counts of males (yellow) and females (blue) vs plot id, showing the number of females to be higher in all plots" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="plotting-distributions">Plotting distributions<a class="anchor" aria-label="anchor" href="#plotting-distributions"></a></h2>
<hr class="half-width"><p>Visualizing distributions is a common task during data exploration
and analysis. To visualize the distribution of <code>weight</code>
within each <code>species_id</code> group, a boxplot can be used:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'species_id'</span>,</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'weight'</span>))</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    <span class="op">+</span> p9.geom_boxplot()</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_boxplot.png" alt="boxplot showing distribution of rodent weight for each species group" class="figure mx-auto d-block"></figure><p>By adding points of the individual observations to the boxplot, we
can have a better idea of the number of measurements and of their
distribution:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'species_id'</span>,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'weight'</span>))</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>    <span class="op">+</span> p9.geom_jitter(alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    <span class="op">+</span> p9.geom_boxplot(alpha<span class="op">=</span><span class="fl">0.</span>)</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_point_boxplot.png" alt="Boxplot of weight by species overlaying observation points to visualize the distribution" class="figure mx-auto d-block"></figure><div id="challenge---distributions" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---distributions" class="callout-inner">
<h3 class="callout-title">Challenge - distributions</h3>
<div class="callout-content">
<p>Boxplots are useful summaries, but hide the <em>shape</em> of the
distribution. For example, if there is a bimodal distribution, this
would not be observed with a boxplot. An alternative to the boxplot is
the violin plot (sometimes known as a beanplot), where the shape (of the
density of points) is drawn.</p>
<p>In many types of data, it is important to consider the <em>scale</em>
of the observations. For example, it may be worth changing the scale of
the axis to better distribute the observations in the space of the
plot.</p>
<ul><li>Replace the box plot with a violin plot, see
<code>geom_violin()</code>
</li>
<li>Represent weight on the log10 scale, see
<code>scale_y_log10()</code>
</li>
<li>Add color to the datapoints on your boxplot according to the plot
from which the sample was taken (<code>plot_id</code>)</li>
</ul><p>Hint: Check the class for <code>plot_id</code>. By using
<code>factor()</code> within the <code>aes</code> mapping of a variable,
<code>plotnine</code> will handle the values as category values.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Answers </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'species_id'</span>,</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'weight'</span>,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>                          color<span class="op">=</span><span class="st">'factor(plot_id)'</span>))</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>    <span class="op">+</span> p9.geom_jitter(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    <span class="op">+</span> p9.geom_violin(alpha<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">"0.7"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_log10()</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_challenge_boxplot.png" alt="Violin plot of weight of species shown with weight scaled down and datapoints with color." class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="plotting-time-series-data">Plotting time series data<a class="anchor" aria-label="anchor" href="#plotting-time-series-data"></a></h2>
<hr class="half-width"><p>Let’s calculate the number of counts per year for each species. To do
that we need to group data first and count the species
(<code>species_id</code>) within each group.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>yearly_counts <span class="op">=</span> surveys_complete.groupby([<span class="st">'year'</span>, <span class="st">'species_id'</span>])[<span class="st">'species_id'</span>].count()</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>yearly_counts</span></code></pre>
</div>
<p>When checking the result of the previous calculation, we actually
have both the <code>year</code> and the <code>species_id</code> as a row
index. We can reset this index to use both as column variable:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>yearly_counts <span class="op">=</span> yearly_counts.reset_index(name<span class="op">=</span><span class="st">'counts'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>yearly_counts</span></code></pre>
</div>
<p>Timelapse data can be visualised as a line plot
(<code>geom_line</code>) with years on <code>x</code> axis and counts on
the <code>y</code> axis.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>yearly_counts,</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'counts'</span>))</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>    <span class="op">+</span> p9.geom_line()</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Unfortunately this does not work, because we plot data for all the
species together. We need to tell <code>plotnine</code> to draw a line
for each species by modifying the aesthetic function and map the
species_id to the color:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>yearly_counts,</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'counts'</span>,</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>                          color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>    <span class="op">+</span> p9.geom_line()</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_time_plot.png" alt="Line graph of count per year where data for each species is indicated by a different color" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="faceting">Faceting<a class="anchor" aria-label="anchor" href="#faceting"></a></h2>
<hr class="half-width"><p>As any other library supporting the Grammar of Graphics,
<code>plotnine</code> has a special technique called <em>faceting</em>
that allows to split one plot into multiple plots based on a factor
variable included in the dataset.</p>
<p>Consider our scatter plot of the <code>weight</code> versus the
<code>hindfoot_length</code> from the previous sections:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>,</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'hindfoot_length'</span>,</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>                          color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>)</span></code></pre>
</div>
<p>We can now keep the same code and at the <code>facet_wrap</code> on a
chosen variable to split out the graph and make a separate graph for
each of the groups in that variable. As an example, use
<code>sex</code>:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>,</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'hindfoot_length'</span>,</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>                          color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    <span class="op">+</span> p9.facet_wrap(<span class="st">"sex"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_facet_plot.png" alt="2 scatter plots, one for males and the other for females, of hindfoot length vs weight with colored dots denoting specific species, showing the trend is the same between both male and females of multiple species" class="figure mx-auto d-block"></figure><p>We can apply the same concept on any of the available categorical
variables:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>,</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'hindfoot_length'</span>,</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>                          color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    <span class="op">+</span> p9.facet_wrap(<span class="st">"plot_id"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_facet_all_plot.png" alt="24 individual scatter plots of Hindfoot length vs weight of species with colors denoting species and numbers above plot representing 1 of the 24 plots, showing trends for each unique plot id studied" class="figure mx-auto d-block"></figure><p>The <code>facet_wrap</code> geometry extracts plots into an arbitrary
number of dimensions to allow them to cleanly fit on one page. On the
other hand, the <code>facet_grid</code> geometry allows you to
explicitly specify how you want your plots to be arranged via formula
notation (<code>rows ~ columns</code>; a <code>.</code> can be used as a
placeholder that indicates only one row or column).</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># only select the years of interest</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>survey_2000 <span class="op">=</span> surveys_complete[surveys_complete[<span class="st">"year"</span>].isin([<span class="dv">2000</span>, <span class="dv">2001</span>])]</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>survey_2000,</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>,</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'hindfoot_length'</span>,</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>                          color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>    <span class="op">+</span> p9.facet_grid(<span class="st">"year ~ sex"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_select_plot.png" alt="Set of 4 color scatterplots showing the relationship between weight and hind foot length for 13 species, separated by sex and year" class="figure mx-auto d-block"></figure><div id="challenge---facetting" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---facetting" class="callout-inner">
<h3 class="callout-title">Challenge - facetting</h3>
<div class="callout-content">
<p>Create a separate plot for each of the species that depicts how the
average weight of the species changes through the years.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Answers </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>yearly_weight <span class="op">=</span> surveys_complete.groupby([<span class="st">'year'</span>, <span class="st">'species_id'</span>])[<span class="st">'weight'</span>].mean().reset_index()</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>yearly_weight, mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'year'</span>, y<span class="op">=</span><span class="st">'weight'</span>))</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_line()</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>    <span class="op">+</span> p9.facet_wrap(<span class="st">"species_id"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge---facetting-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---facetting-1" class="callout-inner">
<h3 class="callout-title">Challenge - facetting</h3>
<div class="callout-content">
<p>Based on the previous exercise, visually compare how the weights of
male and females has changed through time by creating a separate plot
for each sex and an individual color assigned to each
<code>species_id</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Answers </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>yearly_weight <span class="op">=</span> surveys_complete.groupby([<span class="st">'year'</span>, <span class="st">'species_id'</span>, <span class="st">'sex'</span>])[<span class="st">'weight'</span>].mean().reset_index()</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>yearly_weight,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>                          y<span class="op">=</span><span class="st">'weight'</span>,</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>                          color<span class="op">=</span><span class="st">'species_id'</span>))</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    <span class="op">+</span> p9.geom_line()</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>    <span class="op">+</span> p9.facet_wrap(<span class="st">"sex"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="further-customization">Further customization<a class="anchor" aria-label="anchor" href="#further-customization"></a></h2>
<hr class="half-width"><p>As the syntax of <code>plotnine</code> follows the original R package
<code>ggplot2</code>, the documentation of <code>ggplot2</code> can
provide information and inspiration to customize graphs. Take a look at
the <code>ggplot2</code> <a href="https://rstudio.github.io/cheatsheets/html/data-visualization.html" class="external-link">cheat
sheet</a>, and think of ways to improve the plot. You can write down
some of your ideas as comments in the Etherpad.</p>
<p>The theming options provide a rich set of visual adaptations.
Consider the following example of a bar plot with the counts per
year.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'factor(year)'</span>))</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_bar()</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_overlap_bars.png" alt="Bar graph of count per year showing overlapping x-axis labels" class="figure mx-auto d-block"></figure><p>Notice that we use the <code>year</code> here as a categorical
variable by using the <code>factor</code> functionality. However, by
doing so, we have the individual year labels overlapping with each
other. The <code>theme</code> functionality provides a way to rotate the
text of the x-axis labels:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'factor(year)'</span>))</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_bar()</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    <span class="op">+</span> p9.theme_bw()</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>    <span class="op">+</span> p9.theme(axis_text_x <span class="op">=</span> p9.element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_good_bars.png" alt="Bar graph of count per year demonstrating how the theme function rotates the x-axis labels" class="figure mx-auto d-block"></figure><p>When you like a specific set of theme-customizations you created, you
can save them as an object to easily apply them to other plots you may
create:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>my_custom_theme <span class="op">=</span> p9.theme(axis_text_x <span class="op">=</span> p9.element_text(color<span class="op">=</span><span class="st">"grey"</span>, size<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>                                                         angle<span class="op">=</span><span class="dv">90</span>, hjust<span class="op">=</span><span class="fl">.5</span>),</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>                           axis_text_y <span class="op">=</span> p9.element_text(color<span class="op">=</span><span class="st">"grey"</span>, size<span class="op">=</span><span class="dv">10</span>))</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>(p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'factor(year)'</span>))</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>    <span class="op">+</span> p9.geom_bar()</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>    <span class="op">+</span> my_custom_theme</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>)</span></code></pre>
</div>
<figure><img src="../fig/06_theme_plot.png" alt="Bar graph of count per year demonstrating the use of a customized theme" class="figure mx-auto d-block"></figure><div id="challenge---customization" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge---customization" class="callout-inner">
<h3 class="callout-title">Challenge - customization</h3>
<div class="callout-content">
<p>Please take another five minutes to either improve one of the plots
generated in this exercise or create a beautiful graph of your own.</p>
<p>Here are some ideas:</p>
<ul><li>See if you can change thickness of lines for the line plot .</li>
<li>Can you find a way to change the name of the legend? What about its
labels?</li>
<li>Use a different color palette (see <a href="https://www.cookbook-r.com/Graphs/Colors_(ggplot2)" class="external-link">http://www.cookbook-r.com/Graphs/Colors_(ggplot2)</a>)</li>
</ul></div>
</div>
</div>
<p>After creating your plot, you can save it to a file in your favourite
format. You can easily change the dimension (and its resolution) of your
plot by adjusting the appropriate arguments (<code>width</code>,
<code>height</code> and <code>dpi</code>):</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>my_plot <span class="op">=</span> (p9.ggplot(data<span class="op">=</span>surveys_complete,</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>           mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'weight'</span>, y<span class="op">=</span><span class="st">'hindfoot_length'</span>))</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>    <span class="op">+</span> p9.geom_point()</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>)</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>my_plot.save(<span class="st">"scatterplot.png"</span>, width<span class="op">=</span><span class="dv">10</span>, height<span class="op">=</span><span class="dv">10</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>The <code>data</code>, <code>aes</code> variables and a
<code>geometry</code> are the main elements of a plotnine graph</li>
<li>With the <code>+</code> operator, additional <code>scale_*</code>,
<code>theme_*</code>, <code>xlab/ylab</code> and <code>facet_*</code>
elements are added</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/06-loops-and-functions.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/08-putting-it-all-together.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/06-loops-and-functions.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Data Workflows and
        </a>
        <a class="chapter-link float-end" href="../instructor/08-putting-it-all-together.html" rel="next">
          Next: Data Ingest and...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/datacarpentry/python-ecology-lesson/edit/main/episodes/07-visualization-ggplot-python.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/datacarpentry/python-ecology-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/python-ecology-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/python-ecology-lesson/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.12" class="external-link">sandpaper (0.16.12)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.6" class="external-link">varnish (1.0.6)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://datacarpentry.github.io/python-ecology-lesson/instructor/07-visualization-ggplot-python.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Making Plots With plotnine",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/python-ecology-lesson/instructor/07-visualization-ggplot-python.html",
  "identifier": "https://datacarpentry.github.io/python-ecology-lesson/instructor/07-visualization-ggplot-python.html",
  "dateCreated": "2015-03-19",
  "dateModified": "2024-03-29",
  "datePublished": "2025-05-27"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

